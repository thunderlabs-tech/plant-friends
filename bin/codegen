#!/usr/bin/env sh
set -e

ROOT=$(cd $(dirname "$0")/..; pwd)

AMPLIFY_HARDCODED_OUTPUT_PATH="src"
DEST_PATH="web-client/src/gen"

echo "üßπ Clear existing generated code"
rm -rf ${ROOT}/${DEST_PATH}

echo "\nüî® Generate Amplify schema, queries and models"
amplify api gql-compile
amplify codegen
amplify codegen models

echo "\nüò† Correct Amplify hardcoded output path"
mkdir ${ROOT}/${DEST_PATH}
mv ${ROOT}/${AMPLIFY_HARDCODED_OUTPUT_PATH}/* ${ROOT}/${DEST_PATH}
rmdir ${ROOT}/${AMPLIFY_HARDCODED_OUTPUT_PATH}

echo "\n‚ú® Run prettier on generated code"
prettier -w ${ROOT}/${DEST_PATH}

echo "\n‚úÖ Done!"
echo "\n‚òùÔ∏è  Don't forget to run 'amplify env pull' to generate aws-exports.js"
