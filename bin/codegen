#!/usr/bin/env sh
set -e

ROOT=$(cd $(dirname "$0")/..; pwd)

AMPLIFY_HARDCODED_OUTPUT_PATH="src"
DEST_PATH="web-client/src/gen"

echo "ðŸ§¹ Clear existing generated code"
rm -rf ${ROOT}/${DEST_PATH}

echo "\nðŸ”¨ Generate Amplify queries, schema and models"
amplify api gql-compile
amplify codegen
amplify codegen models
amplify env pull

echo "\nðŸ˜  Correct Amplify hardcoded output path"
mkdir ${ROOT}/${DEST_PATH}
mv ${ROOT}/${AMPLIFY_HARDCODED_OUTPUT_PATH}/* ${ROOT}/${DEST_PATH}
rmdir ${ROOT}/${AMPLIFY_HARDCODED_OUTPUT_PATH}

echo "\nâœ¨ Run prettier on generated code"
prettier -w ${ROOT}/${DEST_PATH}

echo "\nâœ… Done!"
